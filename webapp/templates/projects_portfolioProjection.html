{% extends 'base.html' %}

{% block title %}
    Investment Portfolio Projection
{% endblock %}

{% block headContent %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        // Delegate the delete button click event for current and future elements
        $('#investment_table tbody').on('click', '.delete-button', function() {
            var investmentId = $(this).data('id');
            deleteRow(investmentId);
        });

        $('#addInvestmentButton').click(function() {
            var formData = {
                'investment_id': $('#investmentId').val(),
                'ideal_proportion': $('#idealProportion').val(),
                'investment_strategy': $('#investmentStrategy').val(),
                'expected_growth': $('#expectedGrowth').val(),
                'random_growth': $('#randomGrowth').is(':checked'),
                'asset_volatility': $('#assetVolatility').val(),
                'growth_decay': $('#growthDecay').is(':checked'),
                'volatility_duration': $('#volatilityDuration').val(),
                'volatility_magnitude': $('#volatilityMagnitude').val(),
                'volatility_phase': $('#volatilityPhase').val(),
                'bullbear_duration': $('#bullbearDuration').val(),
                'bullbear_magnitude': $('#bullbearMagnitude').val(),
                'bullbear_phase': $('#bullbearPhase').val()
            };

            $.ajax({
                url: '/add-investment',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function(response) {
                    // Handle success
                    console.log(response);
                    $('#addInvestmentModal').modal('hide');

                    // Create a new row
                    var newRow = $('<tr>');
                    newRow.append($('<td>').html('<div class="d-flex justify-content-start"><button type="button" class="btn btn-danger btn-sm me-1 delete-button" data-id="' + formData.investment_id + '"><i class="bi bi-trash-fill"></i></button></div>'));
                    newRow.append($('<td>').text(formData.investment_id));
                    newRow.append($('<td>').text(formData.ideal_proportion));
                    newRow.append($('<td>').text(formData.investment_strategy));
                    newRow.append($('<td>').text(formData.expected_growth));
                    newRow.append($('<td>').text(formData.random_growth ? 'Yes' : 'No'));
                    newRow.append($('<td>').text(formData.asset_volatility));
                    newRow.append($('<td>').text(formData.growth_decay ? 'Yes' : 'No'));
                    newRow.append($('<td>').text(formData.volatility_duration));
                    newRow.append($('<td>').text(formData.volatility_magnitude));
                    newRow.append($('<td>').text(formData.volatility_phase));
                    newRow.append($('<td>').text(formData.bullbear_duration));
                    newRow.append($('<td>').text(formData.bullbear_magnitude));
                    newRow.append($('<td>').text(formData.bullbear_phase));

                    // Append the new row to the table
                    $('#investment_table').append(newRow);
                },
                error: function(error) {
                    // Handle errors
                    console.log(error);
                }
            });
        });
    });

    function deleteRow(investmentId) {
        $.ajax({
            url: '/delete-investment',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({investment_id: investmentId}),
            success: function(response) {
                if(response.status === 'success') {
                    $('tr[data-id="' + investmentId + '"]').remove();
                } else {
                    console.log('Error: ', response);
                }
            },
            error: function(error) {
                console.log(error);
            }
        });        
    }
</script>


{% endblock %}

{% block content %}

    <!-- Add New Investment Modal -->
    <div class="modal fade" id="addInvestmentModal" tabindex="-1" aria-labelledby="addInvestmentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addInvestmentModalLabel">Add New Investment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Form for adding new investment -->
                    <form id="addInvestmentForm">

                        
                        <div class="mb-3">
                            <label for="investmentId" class="form-label">Investment ID</label>
                            <input type="text" class="form-control" id="investmentId" required>
                        </div>

                        <div class="mb-3">
                            <label for="idealProportion" class="form-label">Ideal Proportion (%)</label>
                            <input type="number" class="form-control" id="idealProportion" value="20">
                        </div>

                        <div class="mb-3">
                            <label for="investmentStrategy" class="form-label">Investment Strategy</label>
                            <select class="form-select" id="investmentStrategy">
                                <option value="Conservative">Conservative</option>
                                <option value="Medium">Medium</option>
                                <option selected value="Risky">Risky</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="expectedGrowth" class="form-label">Expected Growth (%)</label>
                            <input type="number" class="form-control" id="expectedGrowth" value="5">
                        </div>

                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="randomGrowth" checked>
                            <label class="form-check-label" for="randomGrowth">Random Growth</label>
                        </div>

                        <div class="mb-3">
                            <label for="assetVolatility" class="form-label">Asset Volatility</label>
                            <select class="form-select" id="assetVolatility">
                                <option value="Low">Low</option>
                                <option selected value="Mid">Mid</option>
                                <option value="High">High</option>
                            </select>
                        </div>

                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="growthDecay" checked>
                            <label class="form-check-label" for="growthDecay">Growth Decay</label>
                        </div>

                        <div class="mb-3">
                            <label for="volatilityDuration" class="form-label">Volatility Duration</label>
                            <input type="number" class="form-control" id="volatilityDuration" value="2">
                        </div>

                        <div class="mb-3">
                            <label for="volatilityMagnitude" class="form-label">Volatility Magnitude</label>
                            <input type="number" class="form-control" id="volatilityMagnitude" value="1">
                        </div>

                        <div class="mb-3">
                            <label for="volatilityPhase" class="form-label">Volatility Phase</label>
                            <input type="number" class="form-control" id="volatilityPhase" value="0">
                        </div>

                        <div class="mb-3">
                            <label for="bullbearDuration" class="form-label">BullBear Duration</label>
                            <input type="number" class="form-control" id="bullbearDuration" value="5">
                        </div>

                        <div class="mb-3">
                            <label for="bullbearMagnitude" class="form-label">BullBear Magnitude</label>
                            <input type="number" class="form-control" id="bullbearMagnitude" value="1">
                        </div>

                        <div class="mb-3">
                            <label for="bullbearPhase" class="form-label">BullBear Phase</label>
                            <input type="number" class="form-control" id="bullbearPhase" value="0">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="addInvestmentButton">Add Investment</button>
                </div>
            </div>
        </div>
    </div>


    <div class="container-xxl"> 
        <table class="table table-striped table-hover table-bordered" id="investment_table">
            <thead class="table-dark">
                <tr>
                    <th>Actions</th>
                    <th>Investment ID</th>
                    <th>Ideal Proportion (%)</th>
                    <th>Investment Strategy</th>
                    <th>Expected Growth (%)</th>
                    <th>Random Growth</th>
                    <th>Asset Volatility</th>
                    <th>Growth Decay</th>
                    <th>Volatility Duration</th>
                    <th>Volatility Magnitude</th>
                    <th>Volatility Phase</th>
                    <th>BullBear Duration</th>
                    <th>BullBear Magnitude</th>
                    <th>BullBear Phase</th>
                </tr>
            </thead>
            <tbody>
                {% for investment in investments %}
                <tr data-id="{{ investment.investment_id }}">
                    <td>
                        <div class="d-flex justify-content-start">
                            <!-- Delete Button -->
                            <button type="button" class="btn btn-danger btn-sm me-1 delete-button" data-id="{{ investment.investment_id }}">
                                <i class="bi bi-trash-fill"></i>
                            </button>
                            
                        </div>
                    </td>
                    <td>{{ investment.investment_id }}</td>
                    <td>{{ investment.ideal_proportion }}</td>
                    <td>{{ investment.investment_strategy }}</td>
                    <td>{{ investment.expected_growth }}</td>
                    <td>{{ investment.random_growth }}</td>
                    <td>{{ investment.asset_volatility }}</td>
                    <td>{{ investment.growth_decay }}</td>
                    <td>{{ investment.volatility_duration }}</td>
                    <td>{{ investment.volatility_magnitude }}</td>
                    <td>{{ investment.volatility_phase }}</td>
                    <td>{{ investment.bullbear_duration }}</td>
                    <td>{{ investment.bullbear_magnitude }}</td>
                    <td>{{ investment.bullbear_phase }}</td>
                </tr>
                {% endfor %}                
            </tbody>
        </table>

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addInvestmentModal">Add New Investment</button>

        <p> </p>

    </div>
    <div class="container-xxl"> 
        <iframe src="/dash/" style="width:100%; height:4098px;"></iframe>
    </div>
{% endblock %}
